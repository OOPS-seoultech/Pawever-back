# React Native + Spring Boot 카카오 로그인 역할 분담

## 전체 플로우 및 역할 구분

### 1. 카카오 로그인

| 단계 | 작업 내용 | 담당 |
|------|----------|------|
| 1-1 | 카카오 로그인 버튼 선택 | **프론트엔드** |
| 1-2 | 카카오 API 서버로 인가 코드 발급 요청 | **프론트엔드** (카카오 SDK) |
| 1-3 | 카카오 API 서버가 사용자에게 인증 요청 (카카오톡 또는 카카오계정) | **카카오 서버** |
| 1-4 | 사용자 인증 성공 시 동의 화면 표시 | **카카오 서버** |
| 1-5 | 사용자 동의 완료 | **사용자** |
| 1-6 | 인가 코드를 포함한 Redirect URI로 리다이렉트 | **카카오 서버** → **프론트엔드** |
| 1-7 | **인가 코드를 백엔드로 전달** | **프론트엔드** |
| 1-8 | 인가 코드로 카카오 API에 토큰 발급 요청 | **백엔드** |
| 1-9 | 액세스 토큰 발급 및 사용자-앱 연결 | **카카오 서버** → **백엔드** |

### 2. 회원 확인 및 등록

| 단계 | 작업 내용 | 담당 |
|------|----------|------|
| 2-1 | 발급받은 토큰으로 카카오 사용자 정보 조회 API 요청 | **백엔드** |
| 2-2 | 사용자 정보 응답 | **카카오 서버** → **백엔드** |
| 2-3 | 카카오 ID로 기존 회원 여부 확인 (DB 조회) | **백엔드** |
| 2-4 | 신규 회원인 경우 회원 등록 (DB INSERT) | **백엔드** |
| 2-5 | 기존 회원인 경우 회원 정보 업데이트 (선택사항) | **백엔드** |

### 3. 서비스 로그인

| 단계 | 작업 내용 | 담당 |
|------|----------|------|
| 3-1 | 자체 JWT 토큰 생성 | **백엔드** |
| 3-2 | JWT와 사용자 정보를 프론트엔드에 응답 | **백엔드** → **프론트엔드** |
| 3-3 | JWT를 로컬 스토리지에 저장 | **프론트엔드** |
| 3-4 | 로그인 완료 처리 및 메인 화면으로 이동 | **프론트엔드** |

---

## 상세 역할 구분

### 프론트엔드 (React Native) 담당

```
📱 사용자 인터페이스 및 카카오 SDK 처리
```

1. **카카오 로그인 UI**
   - 카카오 로그인 버튼 표시
   - 버튼 클릭 이벤트 처리

2. **카카오 SDK 연동**
   - `@react-native-seoul/kakao-login` 라이브러리 사용
   - 카카오톡 앱 실행 또는 카카오계정 로그인 화면 표시
   - 인가 코드 또는 액세스 토큰 수신

3. **백엔드 API 호출**
   - 받은 인가 코드/액세스 토큰을 백엔드로 전송
   - `POST /api/auth/kakao` 요청

4. **로그인 세션 관리**
   - 백엔드에서 받은 JWT 저장 (AsyncStorage)
   - 로그인 완료 후 메인 화면으로 네비게이션

5. **이후 API 요청**
   - 모든 API 요청 헤더에 JWT 포함
   - 토큰 만료 시 로그인 화면으로 이동

### 백엔드 (Spring Boot) 담당

```
🖥️ 인증 검증 및 비즈니스 로직 처리
```

1. **카카오 토큰 처리**
   - 프론트에서 받은 인가 코드/액세스 토큰 수신
   - 인가 코드인 경우 → 카카오 API로 액세스 토큰 교환
   - 액세스 토큰 유효성 검증

2. **카카오 사용자 정보 조회**
   - 카카오 API (`https://kapi.kakao.com/v2/user/me`) 호출
   - 사용자 ID, 이메일, 닉네임, 프로필 이미지 등 받기

3. **회원 관리**
   - DB에서 카카오 ID로 기존 회원 조회
   - 신규 회원: User 테이블에 INSERT
   - 기존 회원: 필요시 정보 UPDATE

4. **자체 인증 토큰 발급**
   - JWT 생성 (사용자 ID, 역할 등 포함)
   - Refresh Token 생성 (선택사항)

5. **응답 반환**
   - JWT + 사용자 정보를 JSON으로 프론트에 전달

6. **API 인증**
   - 이후 모든 API 요청에서 JWT 검증
   - 만료/유효하지 않은 토큰 → 401 응답

---

## React Native에서의 구현 방식
- 네이티브 SDK 또는 REST API 사용 필요

**구현 방식:**
1. **서드파티 라이브러리 사용** (권장)
   - `@react-native-seoul/kakao-login` 
   - 카카오톡 앱 연동 지원
   - 네이티브 모듈로 구현

2. **순수 REST API**
   - WebView로 카카오 로그인 페이지 표시
   - 인가 코드 받아서 백엔드로 전달

---

## 데이터 흐름

### 프론트엔드 → 백엔드

```json
POST /api/auth/kakao
{
  "accessToken": "카카오에서_받은_액세스_토큰"
}
```

또는

```json
POST /api/auth/kakao
{
  "code": "카카오에서_받은_인가_코드"
}
```

### 백엔드 → 프론트엔드

```json
{
  "token": "자체_발급한_JWT",
  "user": {
    "id": 1,
    "email": "user@kakao.com",
    "nickname": "사용자닉네임",
    "profileImage": "https://...",
    "createdAt": "2025-02-12T10:30:00"
  }
}
```

---

## 체크리스트

### 프론트엔드 개발자

- [ ] 카카오 Native App Key 발급받기
- [ ] `@react-native-seoul/kakao-login` 설치 및 설정
- [ ] 카카오 로그인 버튼 구현
- [ ] 액세스 토큰을 백엔드로 전송
- [ ] JWT 받아서 로컬 스토리지에 저장
- [ ] API 요청 시 JWT 자동 포함 (Axios Interceptor)
- [ ] 401 에러 시 로그인 화면으로 이동

### 백엔드 개발자

- [ ] 카카오 REST API Key 및 Client Secret 발급
- [ ] `POST /api/auth/kakao` 엔드포인트 구현
- [ ] 카카오 사용자 정보 조회 API 연동
- [ ] User 엔티티 및 Repository 구현
- [ ] JWT 생성 로직 구현
- [ ] JWT 검증 필터/인터셉터 구현
- [ ] 회원가입/로그인 로직 구현
